import{_ as w,c as a,a as Q,d as V,C as k,o as d,e as r,f as o,t as u,w as E,v as L,h as y,F as C,g as O,N as R,q as T,k as U}from"./index-gxZJ1D_R.js";import{a as h}from"./studentStoreApi-CODCpp5B.js";const W="/assets/coupon-BUEPidbW.png",z={class:"modal-wrap"},A={class:"modal-container shadow-lg p-2"},G={class:"row card-body align-items-start p-2"},H={class:"col-8"},J={class:"d-block fs-5 fw-bold"},K={class:"text-end mb-2"},X={class:"fs-5 fw-semibold primary"},Y={class:"mb-3 d-flex justify-content-between"},Z={class:"d-flex"},oo=["disabled"],so={class:"fs-4 fw-semibold text-danger"},to={key:0,class:"confirm-modal"},eo={key:1,class:"confirm-modal"},no={key:2,class:"confirm-modal"},co={class:"confirm-container shadow-lg p-4"},ao={class:"fs-5 fw-semibold"},lo={__name:"StoreItemDetails",props:{couponId:{type:Number,required:!0},coupon:{type:Object,required:!0}},emits:["close","couponBuy"],setup(i,{emit:v}){const s=a(1),p=a(0);a(!1);const n=a(!1),f=a(!1),m=a(!1),l=a({}),b=Q(),e=i;a("");const $=async()=>{if(!e.couponId){console.error("Invalid coupon ID:",e.couponId);return}try{const c=await h.getCouponById(e.couponId);l.value=c,p.value=l.value.cpPrice}catch(c){console.error("Failed to fetch coupon details:",c)}},B=()=>{n.value=!0},g=()=>{n.value=!1},M=()=>{_("close"),b.go(0),f.value=!1},P=()=>{_("close"),m.value=!1},S=()=>{s.value>1&&s.value--},q=()=>{s.value++},N=V(()=>s.value*p.value),_=v,j=()=>{_("close")},x=a({cpId:e.couponId,quantity:"",price:e.coupon.cpPrice}),I=a(""),D=async()=>{try{x.value.quantity=s.value;const c=await h.buyCoupon(x);console.log("buy==============================> ",c),c&&c.status===200&&(e.coupon.cpQuantity-=s.value,_("couponBuy",{couponId:e.couponId,coupon:e.coupon}),g(),f.value=!0)}catch(c){console.log(c.response),I.value=c.response.data,console.error("쿠폰 사기 실패",c),g(),m.value=!0}};return k(()=>{$()}),(c,t)=>(d(),r(C,null,[o("div",z,[o("div",A,[o("div",G,[t[4]||(t[4]=o("div",{class:"col-4 mt-2"},[o("div",{class:"imgBox"},[o("img",{src:W,alt:"쿠폰 이미지"})])],-1)),o("div",H,[o("div",{class:"d-flex justify-content-between"},[t[2]||(t[2]=o("span",{class:"d-block mt-2 text-muted fs-6"},"쿠폰",-1)),o("button",{class:"btn btn-outline-secondary text-center",onClick:j},t[1]||(t[1]=[o("i",{class:"bi bi-x-lg"},null,-1)]))]),o("div",null,[o("span",J,u(l.value.cpName),1)]),o("div",K,[o("span",X,u(l.value.cpQuantity)+"개 / "+u(l.value.cpPrice)+" 씨드",1)]),o("div",null,u(l.value.cpContent),1),t[3]||(t[3]=o("div",{class:"mb-4"},null,-1)),o("div",Y,[o("div",Z,[o("button",{class:"button cyan small fs-5",onClick:S},"-"),E(o("input",{type:"text",class:"form-control text-center fs-6 fw-semibold","onUpdate:modelValue":t[0]||(t[0]=F=>s.value=F)},null,512),[[L,s.value]]),o("button",{class:"button cyan small fs-5",disabled:s.value>=l.value.cpQuantity,onClick:q},"+",8,oo)]),o("div",so,[o("span",null,u(N.value)+" 씨드",1)])]),o("div",{class:"text-end"},[o("button",{class:"btn btn-primary",onClick:B},"구매하기")])])])])]),n.value?(d(),r("div",to,[o("div",{class:"confirm-container shadow-lg p-4"},[t[5]||(t[5]=o("p",{class:"fs-5 fw-semibold"},"정말로 구매하시겠습니까?",-1)),o("div",{class:"d-flex justify-content-center mt-3",style:{gap:"10px"}},[o("button",{class:"btn btn-primary",onClick:D},"구매"),o("button",{class:"btn btn-secondary",onClick:g},"취소")])])])):y("",!0),f.value?(d(),r("div",eo,[o("div",{class:"confirm-container shadow-lg p-4"},[t[6]||(t[6]=o("p",{class:"fs-5 fw-semibold"},"구매가 완료되었습니다!",-1)),o("div",{class:"d-flex justify-content-center mt-3"},[o("button",{class:"btn btn-primary",onClick:M},"확인")])])])):y("",!0),m.value?(d(),r("div",no,[o("div",co,[o("p",ao,u(I.value),1),o("div",{class:"d-flex justify-content-center mt-3"},[o("button",{class:"btn btn-primary",onClick:P},"확인")])])])):y("",!0)],64))}},io=w(lo,[["__scopeId","data-v-41b13fab"]]),uo={class:"container"},ro={class:"card shadow-lg p-2"},po={class:"card-body align-items-center"},mo={class:"row"},vo={class:"imgBox"},fo=["src"],bo={class:"row"},_o={class:"mb-2"},yo={class:"fs-5 fw-bold d-block coupon-name"},go={class:"mb-4"},ho={class:"fs-5 fw-semibold primary"},wo={class:"mb-4"},Co={class:"fs-6 text-muted"},xo={class:"fw-bold"},Io={__name:"StoreItem",props:{coupon:{type:Object,required:!0}},emits:["couponBuy"],setup(i,{emit:v}){const s=a(!1),p=()=>{s.value=!s.value},n=i,f=v,m=()=>{f("couponBuy",n.coupon)},l=b=>"/src/assets/images/coupon.png";return(b,e)=>(d(),r(C,null,[o("div",uo,[o("div",ro,[o("div",po,[o("div",mo,[o("div",vo,[o("img",{src:l(i.coupon.cpImage),alt:"쿠폰 이미지"},null,8,fo)])]),o("div",bo,[e[1]||(e[1]=o("span",{class:"d-block mt-2 text-muted fs-6"},"쿠폰",-1)),o("div",_o,[o("span",yo,u(i.coupon.cpName),1)]),o("div",go,[o("span",ho,u(i.coupon.cpPrice)+" 씨드",1)]),o("div",wo,[o("span",Co,[e[0]||(e[0]=O("남은 수량: ")),o("span",xo,u(i.coupon.cpQuantity),1)])]),o("div",null,[o("button",{class:"btn btn-primary btn-lg w-100",onClick:p},"상세보기")])])])])]),s.value?(d(),R(io,{key:0,couponId:i.coupon.cpId,coupon:i.coupon,onClose:p,onCouponBuy:m},null,8,["couponId","coupon"])):y("",!0)],64))}},ko=w(Io,[["__scopeId","data-v-189d1f43"]]),$o={class:"container mt-5"},Bo={class:"row g-0"},Mo={__name:"StudentStorePage",setup(i){const v=a([]),s=async()=>{try{const n=await h.getCouponlist();v.value=n}catch(n){console.error("Failed to fetch coupon list:",n)}};k(()=>{s()});const p=n=>{console.log("Coupon purchased:",n)};return(n,f)=>(d(),r("div",$o,[o("div",Bo,[(d(!0),r(C,null,T(v.value,(m,l)=>(d(),r("div",{class:"col-12 col-md-6 col-lg-4 mb-4",key:l},[U(ko,{coupon:m,onCouponBuy:p},null,8,["coupon"])]))),128))])]))}},qo=w(Mo,[["__scopeId","data-v-8d302d75"]]);export{qo as default};
