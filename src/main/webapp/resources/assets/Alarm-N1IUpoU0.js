import{_ as v,b as u,c as m,E as f,K as y,o as c,e as n,f as p,F as S,q as b,S as d,t as k,B as E,C as w}from"./index-DvTNLHIP.js";const A=t=>(E("data-v-c1a9124b"),t=t(),w(),t),I={class:"container my-4"},x=A(()=>p("h2",{class:"text-center p-3 bg-light border rounded"},"알람 페이지",-1)),B={class:"list-group"},F=["onClick"],C={__name:"Alarm",setup(t){u();const o=m([]);let r;const l=m({usernmae:""}),_=async()=>{try{const e=await h(),s=await d.get("/api/alarm/history",{params:{username:e.username}});o.value=s.data}catch(e){console.error("Failed : ",e)}},h=async()=>{const e=u();return l.username=e.username,l},g=async(e,s)=>{try{console.log(e);const a=d.post("/api/alarm/checked/"+e);o.value.splice(s,1)}catch(a){console.error("Failed checked alarm",a)}};return f(()=>{_();const e=1;r=new EventSource(`/api/alarm/subscribe/${e}`),r.addEventListener("alarm",s=>{const a=s.data;console.log(a),o.value=[...o.value,{message:a}]}),r.onerror=s=>{console.error("Error with SSE connection",s)}}),y(()=>{r&&r.close()}),(e,s)=>(c(),n("div",I,[x,p("ul",B,[(c(!0),n(S,null,b(o.value,(a,i)=>(c(),n("li",{key:i,class:"list-group-item mb-1 alarm-item",onClick:L=>g(a.id,i)},k(a.message),9,F))),128))])]))}},T=v(C,[["__scopeId","data-v-c1a9124b"]]);export{T as default};
